
<%- include('navbar.ejs') %>
<div class="container-flude">
    

<!-- <div class="container mt-4"> -->
  <h2 class="mb-4">Admin Dashboard</h2>
  <div class="row g-4">
    <div class="col-md-3">
      <div class="card bg-primary text-white text-center p-3 rounded">
        <h4>Customers</h4>
        <p><%= customers %></p>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card bg-success text-white text-center p-3 rounded">
        <h4>Products</h4>
        <p><%= products %></p>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card bg-warning text-dark text-center p-3 rounded">
        <h4>Orders</h4>
        <p><%= orders %></p>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card bg-danger text-white text-center p-3 rounded">
        <h4>Revenue</h4>
        <p>&#8377; <%= revenue %></p>
      </div>
    </div>
  </div>

  <div class="container mt-5">
      <div class="row">
          <div class="col-md-6">
              <h2 class="text-center">Order Status Summary</h2>
              <canvas id="orderStatusChart" height="200"></canvas>
  
          </div>
          <div class="col-md-1">

          </div>
          <div class="col-md-5">
              <h2 class="text-center">Product Status Summary</h2>
              <canvas id="productChart" height="100"></canvas>
  
          </div>
      </div>
  </div>
  <div class="mt-5">
    <h4>Recent Orders</h4>
    <table class="table table-striped">
      <thead class="table-dark">
        <tr>
          <th>Order ID</th>
          <th>Customer</th>
          <th>Amount</th>
          <th>Status</th>
          <th>Date</th>
        </tr>
      </thead>
      <tbody>
        <% recentOrders.forEach(order => { %>
          <tr>
            <td><%= order.order_id %></td>
            <td><%= order.customer_name %></td>
            <td>&#8377; <%= order.order_amount %></td>
            <td><%= order.order_status %></td>
            <td><%= new Date(order.order_date).toLocaleDateString() %></td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </div>
</div>


<!-- </div> -->

<script>
  fetch("/admin/order-status-summary")
  .then(res => res.json())
  .then(data => {
    const ctx = document.getElementById('orderStatusChart').getContext('2d');
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['Pending', 'Dispatched', 'Delivered', 'Returned', 'Reject'], // <-- correct place
        datasets: [{
          label: 'Number of Orders',
          data: [
            data.pending,
            data.dispatched,
            data.delivered,
            data.returned,
            data.reject // <-- corrected key
          ],
          backgroundColor: [
            'rgba(255, 206, 86, 0.7)',
            'rgba(54, 162, 235, 0.7)',
            'rgba(75, 192, 192, 0.7)',
            'rgba(255, 99, 132, 0.7)',
            'rgba(254, 162, 82, 0.7)'
          ],
          borderColor: [
            'rgba(255, 206, 86, 1)',
            'rgba(54, 162, 235, 1)',
            'rgba(75, 192, 192, 1)',
            'rgba(255, 99, 132, 1)',
            'rgba(254, 162, 82, 1)'
          ],
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { display: false }
        },
        scales: {
          y: { beginAtZero: true }
        }
      }
    });
  })
  .catch(err => console.error("Chart load error:", err));

fetch("/admin/product-status-summary")
  .then((res) => res.json())
  .then((data) => {
    const ctx = document.getElementById("productChart").getContext("2d");
    new Chart(ctx, {
      type: "pie",
      data: {
        labels: ["T-shirt", "Pants", "Shirt", "Jacket", "Kurti"],
        datasets: [
          {
            label: "Product Count",
            data: [data.t_shirt, data.pants, data.shirt, data.jacket, data.kurti],
            backgroundColor: [
              "#007bff",
              "#28a745",
              "#ffc107",
              "#dc3545",
              "#6f42c1"
            ]
          }
        ]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { display: false },
          title: {
            display: true,
            text: "Product Category Status"
          }
        }
      }
    });
  })
  .catch((err) => {
    console.error("Chart load error:", err);
  });

</script>

<%- include('footer.ejs') %>
